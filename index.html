<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocabSnap - Gradient Glass Edition</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #fafafa;
            --bg-secondary: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --text-muted: #999999;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-main: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.18);
            --shadow-glass: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --pill-default: #f0f0f5;
            --pill-selected: #c4b5fd;
            --pill-correct: #86efac;
            --pill-wrong: #fca5a5;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #0a0a0f;
                --bg-secondary: #16161d;
                --text-primary: #ffffff;
                --text-secondary: #b0b0b0;
                --text-muted: #707070;
                --glass-bg: rgba(22, 22, 29, 0.4);
                --glass-border: rgba(255, 255, 255, 0.08);
                --shadow-glass: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
                --pill-default: #2a2a35;
                --pill-selected: #8b5cf6;
                --pill-correct: #22c55e;
                --pill-wrong: #ef4444;
            }
        }
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            -webkit-tap-highlight-color: transparent;
        }
        
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-glass);
        }
        
        .gradient-text {
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .word-card {
            background: var(--bg-secondary);
            border: 2px solid transparent;
            border-radius: 24px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .word-card:hover {
            border-color: rgba(102, 126, 234, 0.3);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
        }
        
        .pill-button {
            padding: 16px 32px;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 18px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .pill-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .pill-button:active {
            transform: translateY(0);
        }
        
        .pill-default {
            background: var(--pill-default);
            color: var(--text-primary);
        }
        
        .pill-selected {
            background: var(--pill-selected);
            color: white;
        }
        
        .pill-correct {
            background: var(--pill-correct);
            color: white;
        }
        
        .pill-wrong {
            background: var(--pill-wrong);
            color: white;
        }
        
        .speed-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .speed-btn {
            min-width: 80px;
            height: 56px;
            padding: 0 16px;
            border-radius: 16px;
            border: 2px solid var(--glass-border);
            background: var(--glass-bg);
            color: var(--text-primary);
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }
        
        .speed-btn:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .speed-dropdown-menu {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 8px;
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--glass-border);
            overflow: hidden;
            z-index: 1000;
        }
        
        .speed-dropdown-item {
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            text-align: center;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .speed-dropdown-item:last-child {
            border-bottom: none;
        }
        
        .speed-dropdown-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .speed-dropdown-item.active {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
        }
        
        .animate-float {
            animation: float 6s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .animate-glow {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { filter: drop-shadow(0 0 5px rgba(102, 126, 234, 0.5)); }
            to { filter: drop-shadow(0 0 20px rgba(102, 126, 234, 0.8)); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .animate-shake {
            animation: shake 0.2s ease-in-out 0s 2;
        }
        
        .perspective { perspective: 1000px; }
        .card-inner { 
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
        }
        .card-flipped { transform: rotateY(180deg); }
        .card-front, .card-back { 
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .card-back { transform: rotateY(180deg); }
        
        .fade-in {
            animation: fadeIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .nav-btn {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .nav-btn.active {
            transform: scale(1.2);
        }
        
        .hover-lift {
            transition: all 0.3s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
        }
        
        .hover-lift:active {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [words, setWords] = useState(() => JSON.parse(localStorage.getItem('vocab_glass')) || []);
            const [apiKey, setApiKey] = useState(() => localStorage.getItem('google_key_glass') || '');
            const [activeTab, setActiveTab] = useState('list');
            const [speechRate, setSpeechRate] = useState(() => parseFloat(localStorage.getItem('speech_rate')) || 1.0);
            const [showSpeedDropdown, setShowSpeedDropdown] = useState(false);
            
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isConfigOpen, setIsConfigOpen] = useState(false);
            const [isImportOpen, setIsImportOpen] = useState(false);
            const [isEditOpen, setIsEditOpen] = useState(false);
            const [newWord, setNewWord] = useState({ eng: '', vi: '', example: '', image: '' });
            const [editWord, setEditWord] = useState(null);
            const [bulkText, setBulkText] = useState("");
            
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [quizOptions, setQuizOptions] = useState([]);
            const [feedback, setFeedback] = useState(null);
            const [selectedOption, setSelectedOption] = useState(null);
            const [userInput, setUserInput] = useState('');
            const [isListening, setIsListening] = useState(false);
            const [showHint, setShowHint] = useState(false);
            const [fcIndex, setFcIndex] = useState(0);
            const [fcFlipped, setFcFlipped] = useState(false);
            const [viewImageModal, setViewImageModal] = useState(null);
            const [phonetic, setPhonetic] = useState('');

            const dropdownRef = useRef(null);

            useEffect(() => { localStorage.setItem('vocab_glass', JSON.stringify(words)); }, [words]);
            useEffect(() => { localStorage.setItem('google_key_glass', apiKey); }, [apiKey]);
            useEffect(() => { localStorage.setItem('speech_rate', speechRate.toString()); }, [speechRate]);

            // Close dropdown when clicking outside
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                        setShowSpeedDropdown(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            // Fetch phonetic when currentQuestion changes in speak tab
            useEffect(() => {
                const fetchPhonetic = async () => {
                    if (activeTab === 'speak' && currentQuestion) {
                        try {
                            const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${currentQuestion.eng}`);
                            const data = await response.json();
                            if (data && data[0] && data[0].phonetic) {
                                setPhonetic(data[0].phonetic);
                            } else if (data && data[0] && data[0].phonetics && data[0].phonetics[0] && data[0].phonetics[0].text) {
                                setPhonetic(data[0].phonetics[0].text);
                            } else {
                                setPhonetic('');
                            }
                        } catch (e) {
                            setPhonetic('');
                        }
                    }
                };
                fetchPhonetic();
            }, [currentQuestion, activeTab]);

            const playSound = (type) => {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                if (type === 'correct') {
                    osc.frequency.setValueAtTime(880, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.2);
                } else {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.3);
                }
            };

            const speak = async (text, customRate = null) => {
                if (!apiKey || !text) return;
                try {
                    const rate = customRate !== null ? customRate : speechRate;
                    const response = await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            input: { text },
                            voice: { languageCode: 'en-US', name: 'en-US-Neural2-F' },
                            audioConfig: { 
                                audioEncoding: 'MP3',
                                speakingRate: rate
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.audioContent) new Audio(`data:audio/mp3;base64,${data.audioContent}`).play();
                } catch (e) {
                    console.error(e);
                }
            };

            useEffect(() => {
                if (activeTab === 'flashcards' && words.length > 0 && words[fcIndex]) {
                    const timer = setTimeout(() => speak(words[fcIndex].eng), 300);
                    return () => clearTimeout(timer);
                }
            }, [fcIndex, activeTab]);

            const generateQuestion = (tab) => {
                if (words.length < 1) return;
                const randomWord = words[Math.floor(Math.random() * words.length)];
                setCurrentQuestion(randomWord);
                setFeedback(null);
                setSelectedOption(null);
                setUserInput('');
                setShowHint(false);
                setPhonetic('');
                const distractors = words.filter(w => w.id !== randomWord.id).sort(() => 0.5 - Math.random()).slice(0, 3);
                setQuizOptions([randomWord, ...distractors].sort(() => 0.5 - Math.random()));
                if (['quiz', 'listen-choose', 'listen'].includes(tab)) {
                    setTimeout(() => speak(randomWord.eng), 400);
                }
            };

            const handleTabChange = (tab) => {
                setActiveTab(tab);
                setFcFlipped(false);
                if (tab !== 'list' && tab !== 'flashcards') generateQuestion(tab);
            };

            const checkAnswer = (ans) => {
                if (feedback === 'correct') return;
                setSelectedOption(ans);
                const isCorrect = (activeTab === 'quiz' && ans === currentQuestion.vi) ||
                    (activeTab === 'listen-choose' && ans === currentQuestion.eng) ||
                    (['listen', 'speak'].includes(activeTab) && ans.toLowerCase().trim() === currentQuestion.eng.toLowerCase().trim());

                if (isCorrect) {
                    setFeedback('correct');
                    playSound('correct');
                    setTimeout(() => generateQuestion(activeTab), 1500);
                } else {
                    setFeedback('wrong');
                    playSound('wrong');
                    setTimeout(() => {
                        setFeedback(null);
                        setSelectedOption(null);
                    }, 1000);
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const lines = event.target.result.split('\n');
                    const newOnes = lines.map(line => {
                        const p = line.split(/[,\-\t]/);
                        return p.length >= 2 ? {
                            id: Date.now() + Math.random(),
                            eng: p[0].trim(),
                            vi: p[1].trim(),
                            example: p[2] ? p[2].trim() : '',
                            image: ''
                        } : null;
                    }).filter(x => x);
                    setWords([...newOnes, ...words]);
                    setIsImportOpen(false);
                };
                reader.readAsText(file);
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                if (file.size > 2 * 1024 * 1024) {
                    alert('Image size should be less than 2MB');
                    return;
                }
                const reader = new FileReader();
                reader.onload = (event) => {
                    setNewWord({ ...newWord, image: event.target.result });
                };
                reader.readAsDataURL(file);
            };

            const handleEditImageUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                if (file.size > 2 * 1024 * 1024) {
                    alert('Image size should be less than 2MB');
                    return;
                }
                const reader = new FileReader();
                reader.onload = (event) => {
                    setEditWord({ ...editWord, image: event.target.result });
                };
                reader.readAsDataURL(file);
            };

            const openEditModal = (word) => {
                setEditWord({ ...word });
                setIsEditOpen(true);
            };

            const saveEditWord = () => {
                if (!editWord.eng || !editWord.vi) return;
                setWords(words.map(w => w.id === editWord.id ? editWord : w));
                setIsEditOpen(false);
                setEditWord(null);
            };

            const getHintString = (str) => {
                if (str.length <= 2) return str[0] + " _";
                return str[0] + " _ ".repeat(str.length - 2) + str[str.length - 1];
            };

            const getPillClassName = (option, isCorrectOption) => {
                const baseClass = 'pill-button';
                if (feedback === 'correct' && isCorrectOption) return `${baseClass} pill-correct`;
                if (selectedOption === option) {
                    return feedback === 'wrong' ? `${baseClass} pill-wrong animate-shake` : `${baseClass} pill-selected`;
                }
                return `${baseClass} pill-default`;
            };

            const speedOptions = [
                { label: '0.25x', value: 0.25 },
                { label: '0.5x', value: 0.5 },
                { label: '0.75x', value: 0.75 },
                { label: '1x', value: 1.0 }
            ];

            const getCurrentSpeedLabel = () => {
                const current = speedOptions.find(opt => opt.value === speechRate);
                return current ? current.label : '1x';
            };

            return (
                <div className="max-w-md mx-auto min-h-screen flex flex-col relative overflow-x-hidden pb-28" style={{background: 'var(--bg-primary)'}}>
                    {/* Gradient Background Orbs */}
                    <div className="fixed top-0 left-0 w-96 h-96 rounded-full opacity-20 animate-float" style={{background: 'var(--gradient-1)', filter: 'blur(80px)', pointerEvents: 'none'}}></div>
                    <div className="fixed bottom-0 right-0 w-96 h-96 rounded-full opacity-20 animate-float" style={{background: 'var(--gradient-2)', filter: 'blur(80px)', animationDelay: '2s', pointerEvents: 'none'}}></div>
                    
                    <header className="relative z-10 p-6 pb-8">
                        <div className="glass-card rounded-3xl p-6 hover-lift">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-black gradient-text tracking-tight">VocabSnap</h1>
                                    <p className="text-xs font-semibold mt-1" style={{color: 'var(--text-muted)'}}>Gradient Glass Edition</p>
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={() => setIsConfigOpen(true)} className="glass-card w-12 h-12 rounded-2xl flex items-center justify-center hover-lift" style={{color: 'var(--text-primary)'}}>
                                        <i className="fas fa-cog text-lg"></i>
                                    </button>
                                    <button onClick={() => setIsModalOpen(true)} className="w-12 h-12 rounded-2xl flex items-center justify-center text-white hover-lift animate-glow" style={{background: 'var(--gradient-1)'}}>
                                        <i className="fas fa-plus text-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 px-6 relative z-10">
                        {activeTab === 'list' && (
                            <div className="space-y-4 fade-in">
                                <div className="flex justify-between items-center mb-4">
                                    <span className="text-sm font-bold" style={{color: 'var(--text-secondary)'}}>
                                        {words.length} words
                                    </span>
                                    <div className="flex gap-3 text-xs font-semibold">
                                        <button onClick={() => {
                                            const dataStr = JSON.stringify(words, null, 2);
                                            const dataBlob = new Blob([dataStr], { type: 'application/json' });
                                            const url = URL.createObjectURL(dataBlob);
                                            const link = document.createElement('a');
                                            link.href = url;
                                            link.download = `vocabsnap-backup-${new Date().toISOString().split('T')[0]}.json`;
                                            link.click();
                                            URL.revokeObjectURL(url);
                                        }} className="gradient-text font-bold">
                                            EXPORT
                                        </button>
                                        <label className="gradient-text font-bold cursor-pointer">
                                            IMPORT
                                            <input type="file" accept=".json" className="hidden" onChange={(e) => {
                                                const file = e.target.files[0];
                                                if (!file) return;
                                                const reader = new FileReader();
                                                reader.onload = (event) => {
                                                    try {
                                                        const imported = JSON.parse(event.target.result);
                                                        if (Array.isArray(imported)) {
                                                            if (confirm(`Import ${imported.length} words?`)) {
                                                                setWords([...imported, ...words]);
                                                            }
                                                        }
                                                    } catch (err) {
                                                        alert('Invalid JSON file!');
                                                    }
                                                };
                                                reader.readAsText(file);
                                                e.target.value = '';
                                            }} />
                                        </label>
                                        <button onClick={() => setIsImportOpen(true)} className="gradient-text font-bold">TEXT</button>
                                        <button onClick={() => { if (confirm("Clear all?")) setWords([]) }} style={{color: '#f5576c'}} className="font-bold">CLEAR</button>
                                    </div>
                                </div>
                                {words.map(w => (
                                    <div key={w.id} className="word-card hover-lift">
                                        <div className="p-4 rounded-3xl flex items-center gap-4">
                                            {w.image ? (
                                                <img src={w.image} alt={w.eng} className="w-16 h-16 object-cover rounded-2xl cursor-pointer hover:opacity-80 transition" onClick={(e) => { e.stopPropagation(); setViewImageModal(w.image); }} />
                                            ) : (
                                                <div onClick={() => speak(w.eng)} className="w-16 h-16 rounded-2xl flex items-center justify-center cursor-pointer" style={{background: 'var(--gradient-3)'}}>
                                                    <i className="fas fa-volume-up text-white text-xl"></i>
                                                </div>
                                            )}
                                            <div onClick={() => speak(w.eng)} className="flex-1 cursor-pointer">
                                                <p className="font-bold text-lg" style={{color: 'var(--text-primary)'}}>{w.eng}</p>
                                                <p className="text-sm font-semibold gradient-text">{w.vi}</p>
                                                {w.example && <p className="text-xs italic mt-1" style={{color: 'var(--text-muted)'}}>"{w.example}"</p>}
                                            </div>
                                            <div className="flex gap-2" style={{position: 'relative', zIndex: 10}}>
                                                <button onClick={(e) => { e.stopPropagation(); openEditModal(w); }} style={{color: 'var(--text-muted)'}} className="hover:opacity-70 p-2">
                                                    <i className="fas fa-edit"></i>
                                                </button>
                                                <button onClick={(e) => { e.stopPropagation(); setWords(words.filter(x => x.id !== w.id)); }} style={{color: '#f5576c'}} className="hover:opacity-70 p-2">
                                                    <i className="fas fa-trash-alt"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'flashcards' && (
                            <div className="fade-in">
                                {words.length === 0 ? (
                                    <p className="text-center mt-20 font-bold" style={{color: 'var(--text-muted)'}}>Add words first!</p>
                                ) : (
                                    <div className="flex flex-col items-center">
                                        <div className="perspective w-full h-[500px] mb-8">
                                            <div onClick={() => setFcFlipped(!fcFlipped)} className={`card-inner relative w-full h-full cursor-pointer ${fcFlipped ? 'card-flipped' : ''}`}>
                                                <div className="card-front glass-card rounded-3xl p-8 flex flex-col items-center justify-center text-center">
                                                    <span className="text-xs font-bold mb-4 gradient-text">
                                                        Card {fcIndex + 1}/{words.length}
                                                    </span>
                                                    {words[fcIndex].image && (
                                                        <img src={words[fcIndex].image} alt={words[fcIndex].eng} className="w-full h-40 object-cover rounded-2xl mb-4 cursor-pointer hover:opacity-90 transition" onClick={(e) => { e.stopPropagation(); setViewImageModal(words[fcIndex].image); }} />
                                                    )}
                                                    <h2 className="text-5xl font-black mb-4" style={{color: 'var(--text-primary)'}}>{words[fcIndex].eng}</h2>
                                                    <p className="text-sm" style={{color: 'var(--text-muted)'}}>Tap to see meaning</p>
                                                </div>
                                                <div className="card-back rounded-3xl p-8 flex flex-col items-center justify-center text-center text-white" style={{background: 'var(--gradient-1)'}}>
                                                    <h2 className="text-4xl font-black mb-4">{words[fcIndex].vi}</h2>
                                                    {words[fcIndex].example && <p className="bg-white/10 p-4 rounded-2xl text-sm italic mb-4">"{words[fcIndex].example}"</p>}
                                                    {words[fcIndex].image && (
                                                        <img src={words[fcIndex].image} alt={words[fcIndex].eng} className="w-full h-40 object-cover rounded-2xl mb-4 opacity-90 cursor-pointer hover:opacity-100 transition" onClick={(e) => { e.stopPropagation(); setViewImageModal(words[fcIndex].image); }} />
                                                    )}
                                                    <button onClick={(e) => { e.stopPropagation(); speak(words[fcIndex].eng); }} className="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition">
                                                        <i className="fas fa-volume-up text-xl"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex gap-6">
                                            <button onClick={() => { setFcFlipped(false); setFcIndex((fcIndex - 1 + words.length) % words.length); }} className="glass-card w-16 h-16 rounded-full flex items-center justify-center hover-lift" style={{color: 'var(--text-primary)'}}>
                                                <i className="fas fa-arrow-left text-xl"></i>
                                            </button>
                                            <button onClick={() => { setFcFlipped(false); setFcIndex((fcIndex + 1) % words.length); }} className="w-16 h-16 rounded-full flex items-center justify-center text-white hover-lift" style={{background: 'var(--gradient-1)'}}>
                                                <i className="fas fa-arrow-right text-xl"></i>
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {['quiz', 'listen-choose', 'listen', 'speak'].includes(activeTab) && (
                            <div className="glass-card rounded-3xl p-8 min-h-[500px] flex flex-col items-center justify-center text-center fade-in">
                                {words.length === 0 ? (
                                    <p className="font-bold" style={{color: 'var(--text-muted)'}}>Add words first!</p>
                                ) : currentQuestion && (
                                    <div className="w-full">
                                        {activeTab === 'quiz' && (
                                            <>
                                                <div className="mb-10">
                                                    <div className="flex items-center justify-center gap-4 mb-4">
                                                        <h2 className="text-4xl font-black" style={{color: 'var(--text-primary)'}}>{currentQuestion.eng}</h2>
                                                        <button onClick={() => speak(currentQuestion.eng)} className="w-12 h-12 rounded-full flex items-center justify-center text-white" style={{background: 'var(--gradient-3)'}}>
                                                            <i className="fas fa-volume-up"></i>
                                                        </button>
                                                    </div>
                                                    {currentQuestion.example && <p className="text-sm italic" style={{color: 'var(--text-muted)'}}>"{currentQuestion.example}"</p>}
                                                </div>
                                                <div className="flex flex-wrap gap-3 justify-center">
                                                    {quizOptions.map((opt, i) => (
                                                        <button 
                                                            key={i} 
                                                            onClick={() => checkAnswer(opt.vi)} 
                                                            className={getPillClassName(opt.vi, opt.vi === currentQuestion.vi)}
                                                        >
                                                            {opt.vi}
                                                        </button>
                                                    ))}
                                                </div>
                                            </>
                                        )}
                                        {activeTab === 'listen-choose' && (
                                            <>
                                                <button onClick={() => speak(currentQuestion.eng)} className="w-28 h-28 rounded-full mb-10 text-4xl text-white flex items-center justify-center mx-auto hover-lift" style={{background: 'var(--gradient-1)'}}>
                                                    <i className="fas fa-volume-up"></i>
                                                </button>
                                                <div className="flex flex-wrap gap-3 justify-center">
                                                    {quizOptions.map((opt, i) => (
                                                        <button 
                                                            key={i} 
                                                            onClick={() => checkAnswer(opt.eng)} 
                                                            className={getPillClassName(opt.eng, opt.eng === currentQuestion.eng)}
                                                        >
                                                            {opt.eng}
                                                        </button>
                                                    ))}
                                                </div>
                                            </>
                                        )}
                                        {activeTab === 'listen' && (
                                            <>
                                                <div className="flex justify-center gap-4 mb-10">
                                                    <button onClick={() => speak(currentQuestion.eng)} className="w-28 h-28 rounded-full text-4xl text-white flex items-center justify-center hover-lift" style={{background: 'var(--gradient-1)'}}>
                                                        <i className="fas fa-volume-up"></i>
                                                    </button>
                                                    <div className="speed-dropdown" ref={dropdownRef}>
                                                        <button 
                                                            onClick={() => setShowSpeedDropdown(!showSpeedDropdown)} 
                                                            className="speed-btn"
                                                        >
                                                            <span>{getCurrentSpeedLabel()}</span>
                                                            <i className="fas fa-chevron-down" style={{fontSize: '10px'}}></i>
                                                        </button>
                                                        {showSpeedDropdown && (
                                                            <div className="speed-dropdown-menu fade-in">
                                                                {speedOptions.map(option => (
                                                                    <div
                                                                        key={option.value}
                                                                        onClick={() => {
                                                                            setSpeechRate(option.value);
                                                                            setShowSpeedDropdown(false);
                                                                        }}
                                                                        className={`speed-dropdown-item ${speechRate === option.value ? 'active' : ''}`}
                                                                        style={{color: 'var(--text-primary)'}}
                                                                    >
                                                                        {option.label}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <button onClick={() => setShowHint(!showHint)} className={`w-14 h-14 rounded-full border-2 flex items-center justify-center ${showHint ? 'border-yellow-500 bg-yellow-500/20' : ''}`} style={{borderColor: showHint ? '#eab308' : 'var(--glass-border)', color: showHint ? '#eab308' : 'var(--text-muted)'}}>
                                                        <i className={`fas ${showHint ? 'fa-eye-slash' : 'fa-eye'}`}></i>
                                                    </button>
                                                </div>
                                                {showHint && <p className="mb-6 font-black text-2xl tracking-widest fade-in" style={{color: '#eab308'}}>{getHintString(currentQuestion.eng)}</p>}
                                                <input autoFocus className={`w-full p-5 rounded-2xl text-center text-xl font-bold mb-6 outline-none transition-all ${feedback === 'wrong' ? 'animate-shake' : ''}`} style={{
                                                    background: feedback === 'wrong' ? '#f5576c' : (feedback === 'correct' ? '#4ade80' : 'var(--glass-bg)'),
                                                    color: feedback ? '#ffffff' : 'var(--text-primary)',
                                                    border: '2px solid var(--glass-border)'
                                                }} placeholder="Type what you hear..." value={userInput} onChange={e => setUserInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && checkAnswer(userInput)} />
                                                <button onClick={() => checkAnswer(userInput)} className="w-full py-4 rounded-2xl font-black text-white hover-lift" style={{background: feedback === 'wrong' ? '#f5576c' : (feedback === 'correct' ? '#4ade80' : 'var(--gradient-1)')}}>
                                                    {feedback ? feedback.toUpperCase() : 'CHECK'}
                                                </button>
                                            </>
                                        )}
                                        {activeTab === 'speak' && (
                                            <>
                                                <h2 className="text-4xl font-black mb-2" style={{color: 'var(--text-primary)'}}>{currentQuestion.eng}</h2>
                                                {phonetic && <p className="text-lg mb-2" style={{color: '#667eea', fontStyle: 'italic'}}>{phonetic}</p>}
                                                <p className="text-sm font-bold mb-8 gradient-text">{currentQuestion.vi}</p>
                                                <button onClick={() => speak(currentQuestion.eng)} className="w-12 h-12 rounded-full mb-6 flex items-center justify-center mx-auto border-2" style={{background: 'var(--glass-bg)', borderColor: 'var(--glass-border)', color: 'var(--text-primary)'}}>
                                                    <i className="fas fa-volume-up"></i>
                                                </button>
                                                <button onClick={() => {
                                                    const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                                                    rec.lang = 'en-US';
                                                    setIsListening(true);
                                                    rec.start();
                                                    rec.onresult = (e) => {
                                                        const txt = e.results[0][0].transcript;
                                                        setUserInput(txt);
                                                        setIsListening(false);
                                                        checkAnswer(txt);
                                                    };
                                                    rec.onerror = () => setIsListening(false);
                                                }} className={`w-36 h-36 rounded-full text-5xl flex items-center justify-center mx-auto transition-all ${isListening ? 'bg-red-500 animate-pulse text-white' : 'text-white'}`} style={{background: isListening ? '#f5576c' : 'var(--gradient-2)'}}>
                                                    <i className="fas fa-microphone"></i>
                                                </button>
                                                <p className="mt-8 text-xs font-bold" style={{color: 'var(--text-muted)'}}>
                                                    {isListening ? "Listening..." : "Tap to Speak"}
                                                </p>
                                                {userInput && <p className="mt-4 font-bold gradient-text italic">"{userInput}"</p>}
                                            </>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* Bottom Navbar */}
                    <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 w-[90%] max-w-md">
                        <div className="glass-card rounded-full p-3 flex justify-around">
                            {[
                                { icon: 'list-ul', label: 'Words', tab: 'list' },
                                { icon: 'id-card', label: 'Flash', tab: 'flashcards' },
                                { icon: 'brain', label: 'Quiz', tab: 'quiz' },
                                { icon: 'volume-high', label: 'Listen', tab: 'listen-choose' },
                                { icon: 'keyboard', label: 'Type', tab: 'listen' },
                                { icon: 'microphone', label: 'Speak', tab: 'speak' }
                            ].map(item => (
                                <button key={item.tab} onClick={() => handleTabChange(item.tab)} className={`nav-btn flex flex-col items-center gap-1 flex-1 py-1 ${activeTab === item.tab ? 'active' : ''}`} style={{color: activeTab === item.tab ? '#667eea' : 'var(--text-muted)'}}>
                                    <i className={`fas fa-${item.icon} text-3xl`}></i>
                                    <span className="text-[8px] font-bold">{item.label}</span>
                                </button>
                            ))}
                        </div>
                    </nav>

                    {/* Modals */}
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-md z-[100] flex items-center justify-center p-6">
                            <div className="glass-card w-full max-w-sm rounded-3xl p-8 max-h-[90vh] overflow-y-auto">
                                <h3 className="text-2xl font-black mb-6 gradient-text">Add Word</h3>
                                <div className="space-y-4">
                                    <div className="border-2 border-dashed rounded-2xl p-6 text-center" style={{borderColor: 'var(--glass-border)'}}>
                                        {newWord.image ? (
                                            <div className="relative">
                                                <img src={newWord.image} alt="Preview" className="w-full h-40 object-cover rounded-2xl" />
                                                <button onClick={() => setNewWord({ ...newWord, image: '' })} className="absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center">
                                                    <i className="fas fa-times"></i>
                                                </button>
                                            </div>
                                        ) : (
                                            <label className="cursor-pointer block">
                                                <i className="fas fa-image text-4xl mb-3" style={{color: 'var(--text-muted)'}}></i>
                                                <p className="text-xs font-bold" style={{color: 'var(--text-muted)'}}>Add Image (Optional)</p>
                                                <input type="file" accept="image/*" className="hidden" onChange={handleImageUpload} />
                                            </label>
                                        )}
                                    </div>
                                    <input placeholder="English" className="w-full p-4 rounded-2xl outline-none font-bold" style={{background: 'var(--glass-bg)', border: '1px solid var(--glass-border)', color: 'var(--text-primary)'}} value={newWord.eng} onChange={e => setNewWord({ ...newWord, eng: e.target.value })} />
                                    <input placeholder="Vietnamese" className="w-full p-4 rounded-2xl outline-none font-bold" style={{background: 'var(--glass-bg)', border: '1px solid var(--glass-border)', color: 'var(--text-primary)'}} value={newWord.vi} onChange={e => setNewWord({ ...newWord, vi: e.target.value })} />
                                    <textarea placeholder="Example (Optional)" className="w-full p-4 rounded-2xl outline-none text-sm" rows="2" style={{background: 'var(--glass-bg)', border: '1px solid var(--glass-border)', color: 'var(--text-primary)'}} value={newWord.example} onChange={e => setNewWord({ ...newWord, example: e.target.value })}></textarea>
                                    <button onClick={() => {
                                        if (newWord.eng && newWord.vi) {
                                            setWords([{ id: Date.now(), ...newWord }, ...words]);
                                            setIsModalOpen(false);
                                            setNewWord({ eng: '', vi: '', example: '', image: '' });
                                        }
                                    }} className="w-full text-white py-4 rounded-2xl font-black" style={{background: 'var(--gradient-1)'}}>
                                        SAVE
                                    </button>
                                    <button onClick={() => { setIsModalOpen(false); setNewWord({ eng: '', vi: '', example: '', image: '' }); }} className="w-full text-xs font-bold" style={{color: 'var(--text-muted)'}}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {isEditOpen && editWord && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-md z-[100] flex items-center justify-center p-6">
                            <div className="glass-card w-full max-w-sm rounded-3xl p-8 max-h-[90vh] overflow-y-auto">
                                <h3 className="text-2xl font-black mb-6 gradient-text">Edit Word</h3>
                                <div className="space-y-4">
                                    <div className="border-2 border-dashed rounded-2xl p-6 text-center" style={{borderColor: 'var(--glass-border)'}}>
                                        {editWord.image ? (
                                            <div className="relative">
                                                <img src={editWord.image} alt="Preview" className="w-full h-40 object-cover rounded-2xl" />
                                                <button onClick={() => setEditWord({ ...editWord, image: '' })} className="absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center">
                                                    <i className="fas fa-times"></i>
                                                </button>
                                            </div>
                                        ) : (
                                            <label className="cursor-pointer block">
                                                <i className="fas fa-image text-4xl mb-3" style={{color: 'var(--text-muted)'}}></i>
                                                <p className="text-xs font-bold" style={{color: 'var(--text-muted)'}}>Add Image (Optional)</p>
                                                <input type="file" accept="image/*" className="hidden" onChange={handleEditImageUpload} />
                                            </label>
                                        )}
                                    </div>
                                    <input placeholder="English" className="w-full p-4 rounded-2xl outline-none font-bold" style={{background: 'var(--glass-bg)', border: '1px solid var(--glass-border)', color: 'var(--text-primary)'}} value={editWord.eng} onChange={e => setEditWord({ ...editWord, eng: e.target.value })} />
                                    <input placeholder="Vietnamese" className="w-full p-4 rounded-2xl outline-none font-bold" style={{background: 'var(--glass-bg)', border: '1px solid var(--glass-border)', color: 'var(--text-primary)'}} value={editWord.vi} onChange={e => setEditWord({ ...editWord, vi: e.target.value })} />
                                    <textarea placeholder="Example (Optional)" className="w-full p-4 rounded-2xl outline-none text-sm" rows="2" style={{background: 'var(--glass-bg)', border: '1px solid var(--glass-border)', color: 'var(--text-primary)'}} value={editWord.example} onChange={e => setEditWord({ ...editWord, example: e.target.value })}></textarea>
                                    <button onClick={saveEditWord} className="w-full text-white py-4 rounded-2xl font-black" style={{background: 'var(--gradient-1)'}}>
                                        UPDATE
                                    </button>
                                    <button onClick={() => { setIsEditOpen(false); setEditWord(null); }} className="w-full text-xs font-bold" style={{color: 'var(--text-muted)'}}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {isImportOpen && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-md z-[100] flex items-center justify-center p-6">
                            <div className="glass-card w-full max-w-sm rounded-3xl p-8">
                                <h3 className="text-2xl font-black mb-6 gradient-text">Import Text</h3>
                                <label className="block mb-6 p-6 border-2 border-dashed rounded-2xl cursor-pointer hover:opacity-80 transition" style={{borderColor: 'var(--glass-border)'}}>
                                    <i className="fas fa-file-alt text-4xl mb-3" style={{color: 'var(--text-muted)'}}></i>
                                    <span className="block text-xs font-bold" style={{color: 'var(--text-muted)'}}>Pick .txt file</span>
                                    <input type="file" accept=".txt" className="hidden" onChange={handleFileUpload} />
                                </label>
                                <textarea className="w-full h-32 p-4 rounded-2xl mb-4 text-sm outline-none" placeholder="Eng, Vi, Example" style={{background: 'var(--glass-bg)', border: '1px solid var(--glass-border)', color: 'var(--text-primary)'}} value={bulkText} onChange={e => setBulkText(e.target.value)}></textarea>
                                <button onClick={() => {
                                    const lines = bulkText.split('\n');
                                    const newOnes = lines.map(line => {
                                        const p = line.split(/[,\-\t]/);
                                        return p.length >= 2 ? {
                                            id: Date.now() + Math.random(),
                                            eng: p[0].trim(),
                                            vi: p[1].trim(),
                                            example: p[2] ? p[2].trim() : '',
                                            image: ''
                                        } : null;
                                    }).filter(x => x);
                                    setWords([...newOnes, ...words]);
                                    setIsImportOpen(false);
                                    setBulkText("");
                                }} className="w-full text-white py-4 rounded-2xl font-black" style={{background: 'var(--gradient-1)'}}>
                                    IMPORT
                                </button>
                                <button onClick={() => setIsImportOpen(false)} className="w-full mt-4 text-xs font-bold" style={{color: 'var(--text-muted)'}}>
                                    Cancel
                                </button>
                            </div>
                        </div>
                    )}

                    {isConfigOpen && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-md z-[100] flex items-center justify-center p-6">
                            <div className="glass-card w-full max-w-sm rounded-3xl p-8">
                                <h3 className="text-2xl font-black mb-6 gradient-text">Settings</h3>
                                <input type="password" placeholder="Google TTS API Key..." className="w-full p-4 rounded-2xl mb-6 font-mono text-sm outline-none" style={{background: 'var(--glass-bg)', border: '1px solid var(--glass-border)', color: 'var(--text-primary)'}} value={apiKey} onChange={e => setApiKey(e.target.value)} />
                                <button onClick={() => setIsConfigOpen(false)} className="w-full text-white py-4 rounded-2xl font-black" style={{background: 'var(--gradient-1)'}}>
                                    SAVE
                                </button>
                                <button onClick={() => setIsConfigOpen(false)} className="w-full mt-4 text-xs font-bold" style={{color: 'var(--text-muted)'}}>
                                    Close
                                </button>
                            </div>
                        </div>
                    )}

                    {viewImageModal && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-lg z-[200] flex items-center justify-center p-6" onClick={() => setViewImageModal(null)}>
                            <div className="relative max-w-4xl w-full">
                                <button onClick={() => setViewImageModal(null)} className="absolute -top-4 -right-4 w-14 h-14 bg-white text-black rounded-full flex items-center justify-center z-10 hover:bg-red-500 hover:text-white transition">
                                    <i className="fas fa-times text-xl"></i>
                                </button>
                                <img src={viewImageModal} alt="Full view" className="w-full h-auto rounded-3xl" onClick={(e) => e.stopPropagation()} />
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
